<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spawning Decay Analysis • DSMhabitat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spawning Decay Analysis">
<meta property="og:description" content="DSMhabitat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DSMhabitat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/floodplain-modeling.html">Floodplain Modeling Methodology</a>
    </li>
    <li>
      <a href="../articles/habitat-extents-map.html">Map of Spawning and Rearing Habitat</a>
    </li>
    <li>
      <a href="../articles/total-wetted-area.html">Remotely Sensed Wetted Channel Areas</a>
    </li>
    <li>
      <a href="../articles/flow-driven-spawning-decay.html">Spawning Habitat Decay</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CVPIA-OSC/DSMhabitat" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spawning Decay Analysis</h1>
            
      
      
      <div class="hidden name"><code>flow-driven-spawning-decay.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvpia-osc.github.io/DSMhabitat/" class="external-link">DSMhabitat</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<p>The objective of this analysis is to create flow-decay curves that
will be applied to spawning habitat values at runtime in DSM models. The
SRH2D model developed as part of the Sediment Study for the Upper
Sacramento River serves as the starting point for these curves.
Additional “scale-downs” are performed to reduce the magnitude of the
curves in order to better match the observed relationship at each
watershed where the analysis is applied. Each step in the analysis is
detailed below.</p>
</div>
<div class="section level2">
<h2 id="srh2d-flow-sediment-transport-curves">SRH2D Flow-Sediment Transport Curves<a class="anchor" aria-label="anchor" href="#srh2d-flow-sediment-transport-curves"></a>
</h2>
<p>Flow-to-sediment transport curves were obtained from the SRH2D model
output. In total, there are 45 files, each representing a river mile.
Each file contains 3 flow-to-sediment curves (in cubic meters per
second) for three curve types: Parker, Wilcock, and Gaeuman. A sample
output at river mile 283.330 is shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">files_to_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"spawning-decay"</span>, <span class="st">"SedimentRatingCurves"</span>, </span>
<span>                                        package <span class="op">=</span> <span class="st">"DSMhabitat"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                            pattern <span class="op">=</span> <span class="st">".txt"</span>, </span>
<span>                            full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rating_curves_by_rm</span> <span class="op">&lt;-</span> <span class="fu">map_df</span><span class="op">(</span><span class="va">files_to_read</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">river_mile</span> <span class="op">&lt;-</span> <span class="fu">str_match</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"[0-9]+\\.?[0-9]+"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu">read_tsv</span><span class="op">(</span><span class="va">x</span>, skip <span class="op">=</span> <span class="fl">1</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flow"</span>, <span class="st">"parker_qs"</span>, <span class="st">"wilcock_qs"</span>, <span class="st">"gaeuman_qs"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>river_mile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">river_mile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rating_curves_by_rm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">river_mile</span> <span class="op">==</span> <span class="fl">283.330</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">flow</th>
<th align="right">parker_qs</th>
<th align="right">wilcock_qs</th>
<th align="right">gaeuman_qs</th>
<th align="right">river_mile</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">210</td>
<td align="right">0.000071</td>
<td align="right">0.000096</td>
<td align="right">0.000246</td>
<td align="right">283.33</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">0.004994</td>
<td align="right">0.001350</td>
<td align="right">0.003240</td>
<td align="right">283.33</td>
</tr>
<tr class="odd">
<td align="right">750</td>
<td align="right">0.036029</td>
<td align="right">0.005301</td>
<td align="right">0.013065</td>
<td align="right">283.33</td>
</tr>
<tr class="even">
<td align="right">1000</td>
<td align="right">0.150990</td>
<td align="right">0.016174</td>
<td align="right">0.039437</td>
<td align="right">283.33</td>
</tr>
<tr class="odd">
<td align="right">1250</td>
<td align="right">0.368879</td>
<td align="right">0.036586</td>
<td align="right">0.085184</td>
<td align="right">283.33</td>
</tr>
<tr class="even">
<td align="right">1500</td>
<td align="right">0.634368</td>
<td align="right">0.064214</td>
<td align="right">0.142707</td>
<td align="right">283.33</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="right">1.362871</td>
<td align="right">0.149516</td>
<td align="right">0.307467</td>
<td align="right">283.33</td>
</tr>
<tr class="even">
<td align="right">2240</td>
<td align="right">1.774680</td>
<td align="right">0.202681</td>
<td align="right">0.406075</td>
<td align="right">283.33</td>
</tr>
</tbody>
</table>
<p>All data was converted to cubic feet per second and two levels of
summaries were performed. First, at each river mile, the minimum,
average, and maximum values for transport were calculated across the
three different curve types. Then, an average of transport was
calculated for each combination of flow and minimum, mean, and maximum
transport values across all the river miles. The code for the
calculation is outlined below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rating_curve</span> <span class="op">&lt;-</span> <span class="va">rating_curves_by_rm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">rename</span><span class="op">(</span>flow_cms <span class="op">=</span> <span class="va">flow</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">parker_qs</span><span class="op">:</span><span class="va">gaeuman_qs</span>, names_to <span class="op">=</span> <span class="st">"curve"</span>, values_to <span class="op">=</span> <span class="st">"transport_m3_per_second"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    flow_cfs <span class="op">=</span> <span class="fl">35.315</span> <span class="op">*</span> <span class="va">flow_cms</span>,</span>
<span>    flow_cfd <span class="op">=</span> <span class="va">flow_cfs</span> <span class="op">*</span> <span class="fl">86400</span>, <span class="co"># cubic feet per day</span></span>
<span>    transport_ft3_per_second <span class="op">=</span> <span class="fl">35.315</span> <span class="op">*</span> <span class="va">transport_m3_per_second</span>,</span>
<span>    transport_ft3_per_day <span class="op">=</span> <span class="fl">86400</span> <span class="op">*</span> <span class="va">transport_ft3_per_second</span> <span class="co"># transport per day</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">flow_cfs</span>, <span class="va">river_mile</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># summary across 3 curve types </span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    sed_ft3_per_second_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">transport_ft3_per_second</span><span class="op">)</span>, </span>
<span>    sed_ft3_per_second_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">transport_ft3_per_second</span><span class="op">)</span>,</span>
<span>    sed_ft3_per_second_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">transport_ft3_per_second</span><span class="op">)</span>,    </span>
<span>    sed_ft3_per_day_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">transport_ft3_per_day</span><span class="op">)</span>, </span>
<span>    sed_ft3_per_day_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">transport_ft3_per_day</span><span class="op">)</span>,</span>
<span>    sed_ft3_per_day_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">transport_ft3_per_day</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># summary across all river miles</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    sed_ft3_per_second_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_second_min</span><span class="op">)</span>, </span>
<span>    sed_ft3_per_second_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_second_avg</span><span class="op">)</span>,</span>
<span>    sed_ft3_per_second_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_second_max</span><span class="op">)</span>,</span>
<span>    sed_ft3_per_day_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_day_min</span><span class="op">)</span>, </span>
<span>    sed_ft3_per_day_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_day_avg</span><span class="op">)</span>,</span>
<span>    sed_ft3_per_day_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sed_ft3_per_day_max</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>flow_cfd <span class="op">=</span> <span class="va">flow_cfs</span> <span class="op">*</span> <span class="fl">86400</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow-driven-spawning-decay_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="curve-scale-downs">Curve Scale-downs<a class="anchor" aria-label="anchor" href="#curve-scale-downs"></a>
</h2>
<p>A series of scale-downs were performed next. The specific procedures
for each scale-down are outlined in this section.</p>
<div class="section level3">
<h3 id="gravel-size-based-scaledown">Gravel size based scaledown<a class="anchor" aria-label="anchor" href="#gravel-size-based-scaledown"></a>
</h3>
<p>The initial reduction in scale was based on a flow-to-gravel size
movement curve, which, given the flow and size of gravel, calculates the
proportion of gravel that is moving. This curve was obtained by
digitizing a bar plot from the Gravel Study for the Upper Sacramento
River. To align it with the flow-to-transport curves, we calculated the
minimum, mean, and maximum values across the four reaches, and
interpolated flows to match those in the flow-to-transport curves.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravel_size_scaledown</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"spawning-decay"</span>, <span class="st">"sediment-prop-move.csv"</span>, </span>
<span>                                              package <span class="op">=</span> <span class="st">"DSMhabitat"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gravel_size_to_prop_of_movement</span> <span class="op">&lt;-</span> <span class="va">gravel_size_scaledown</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    flow_cfs <span class="op">=</span> <span class="va">flow_m3s</span> <span class="op">*</span> <span class="fl">35.315</span>,</span>
<span>    flow_cfday <span class="op">=</span> <span class="va">flow_cfs</span> <span class="op">*</span> <span class="fl">86400</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    min_fraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">fraction</span><span class="op">)</span>, </span>
<span>    avg_fraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fraction</span><span class="op">)</span>,</span>
<span>    max_fraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fraction</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="op">(</span>flow_cfs <span class="op">=</span> <span class="fl">0</span>, min_fraction <span class="op">=</span> <span class="fl">0</span>, avg_fraction <span class="op">=</span> <span class="fl">0</span>, max_fraction <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># adds 0,0,0 case to match transport curves</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">gravel_size_to_prop_of_movement</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">flow_cfs</th>
<th align="right">min_fraction</th>
<th align="right">avg_fraction</th>
<th align="right">max_fraction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">7416.15</td>
<td align="right">0.0806018</td>
<td align="right">0.0968323</td>
<td align="right">0.1217712</td>
</tr>
<tr class="even">
<td align="right">17657.50</td>
<td align="right">0.1941146</td>
<td align="right">0.2733349</td>
<td align="right">0.3368477</td>
</tr>
<tr class="odd">
<td align="right">26486.25</td>
<td align="right">0.3025297</td>
<td align="right">0.4197242</td>
<td align="right">0.4928835</td>
</tr>
<tr class="even">
<td align="right">35315.00</td>
<td align="right">0.3830666</td>
<td align="right">0.5127448</td>
<td align="right">0.6088125</td>
</tr>
<tr class="odd">
<td align="right">44143.75</td>
<td align="right">0.4161074</td>
<td align="right">0.5452193</td>
<td align="right">0.6550242</td>
</tr>
<tr class="even">
<td align="right">52972.50</td>
<td align="right">0.4367579</td>
<td align="right">0.5705558</td>
<td align="right">0.7044600</td>
</tr>
<tr class="odd">
<td align="right">70630.00</td>
<td align="right">0.4470831</td>
<td align="right">0.5785127</td>
<td align="right">0.7442235</td>
</tr>
<tr class="even">
<td align="right">79105.60</td>
<td align="right">0.4288639</td>
<td align="right">0.5421749</td>
<td align="right">0.7603439</td>
</tr>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravel_size_to_prop_of_movement</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"prop_type"</span>, values_to <span class="op">=</span> <span class="st">"Proportion able to Move"</span>, <span class="op">-</span><span class="va">flow_cfs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">flow_cfs</span>, <span class="va">`Proportion able to Move`</span>, color <span class="op">=</span> <span class="va">prop_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> </span></code></pre></div>
<p><img src="flow-driven-spawning-decay_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="section level4">
<h4 id="first-scaledown-curve-application">First Scaledown Curve Application<a class="anchor" aria-label="anchor" href="#first-scaledown-curve-application"></a>
</h4>
<p>The method we use to generate these scaled-down curves is the
<code>approxfun</code> function generator in R. The following outlines
the process. Note that at this point we must choose between one of three
(min, mean, max) curves to use as the input into
<code>approxfun</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using the min</span></span>
<span></span>
<span><span class="va">min_sfd_gravel_size_red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_min</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span></span>
<span><span class="op">)</span></span>
<span><span class="va">avg_sfd_gravel_size_red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_avg</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span></span>
<span><span class="op">)</span></span>
<span><span class="va">max_sfd_gravel_size_red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_max</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can recalculate the transport curves with this scaledown by apply
our generated functions above.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_sfd_with_gravel_scale</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">min_sfd_gravel_size_red</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"min"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">avg_sfd_with_gravel_scale</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">avg_sfd_gravel_size_red</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"mean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">max_sfd_with_gravel_scale</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">max_sfd_gravel_size_red</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"max"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transport_scaled_by_gravel</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="va">min_sfd_with_gravel_scale</span>, </span>
<span>  <span class="va">avg_sfd_with_gravel_scale</span>, </span>
<span>  <span class="va">max_sfd_with_gravel_scale</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">transport_scaled_by_gravel</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">flow_cfs</span>, <span class="va">transport_cfd</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> </span></code></pre></div>
<p><img src="flow-driven-spawning-decay_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="storm-observed-based-scaledown">Storm Observed based Scaledown<a class="anchor" aria-label="anchor" href="#storm-observed-based-scaledown"></a>
</h3>
<p>The next scale-down is based on observed sediment transport and
Market Bridge within the Upper Sacramento River. The approach is to
develop a scale-down factor that allows the curves to match this
observed event. The setup is simple: we start with a known amount of
gravel and a known date at which the gravel was moved away. We create a
function out of this process and feed it into an optimization process
that finds the scale-down value that best matches the event.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kwk_usgs</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"spawning-decay"</span>, <span class="st">"kwk-flows-1980-2022.rds"</span>, </span>
<span>                                 package <span class="op">=</span> <span class="st">"DSMhabitat"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objective_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># scale down the tranport curves to just the d50mm threshold of movement</span></span>
<span>  <span class="va">scaled_sed_transport</span> <span class="op">&lt;-</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_min</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span></span>
<span>  </span>
<span>  <span class="co"># create an approxfun given a threshold of movement (this value will be searched by the optim function)</span></span>
<span>  <span class="va">calib_sed_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>                               <span class="va">scaled_sed_transport</span> <span class="op">*</span> </span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="co"># &lt;----- this value is searched </span></span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># convert square meters to cubic feet, assume 2ft depth</span></span>
<span>  <span class="va">starting_volume</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">254690.3</span> <span class="op">*</span> <span class="fl">10.764</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">calib_kwk_sed_transport</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    date <span class="op">=</span> <span class="va">kwk_usgs</span><span class="op">$</span><span class="va">Date</span>, </span>
<span>    flow <span class="op">=</span> <span class="va">kwk_usgs</span><span class="op">$</span><span class="va">Flow</span>, </span>
<span>    sediment_transport_f3_day <span class="op">=</span> <span class="fu">calib_sed_curve</span><span class="op">(</span><span class="va">flow</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>sediment_transport_f3_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sediment_transport_f3_day</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sediment_transport_f3_day</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">calib_kwk_sed_transport_sim</span> <span class="op">&lt;-</span> <span class="va">calib_kwk_sed_transport</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2015-01-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2017-04-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>sediment_transport_f3_day_accum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">sediment_transport_f3_day</span><span class="op">)</span>,</span>
<span>           current_vol <span class="op">=</span> <span class="va">starting_volume</span> <span class="op">-</span> <span class="va">sediment_transport_f3_day_accum</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># get the last value for volume</span></span>
<span>  <span class="va">last_volume</span> <span class="op">&lt;-</span> <span class="va">calib_kwk_sed_transport_sim</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pull</span><span class="op">(</span><span class="va">current_vol</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return absolute distance to zero</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">last_volume</span> <span class="op">-</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># We want to optimize the function by the threshold value that results</span></span>
<span><span class="co"># in the volumne nearest zero.</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimise</a></span><span class="op">(</span><span class="va">objective_func</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, maximum <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The <code>optimise</code> function returns: Scale-down value:
<strong>0.5099701</strong>, which gets us within
<strong>177.844</strong> cubic feet of zero. We can evaluate this fit by
plotting both the flow and volume decay on the same axis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sac_river_observation_scaledown</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">minimum</span></span>
<span></span>
<span><span class="co"># create a new curve with this scaledown applied</span></span>
<span><span class="va">flow_cfs_to_sed_cfd_calibrated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_min</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span> <span class="op">*</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sac_river_observation_scaledown</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">calibrated_kwk_sed_transport</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">kwk_usgs</span><span class="op">$</span><span class="va">Date</span>, </span>
<span>  flow <span class="op">=</span> <span class="va">kwk_usgs</span><span class="op">$</span><span class="va">Flow</span>, </span>
<span>  sediment_transport_f3_day <span class="op">=</span> <span class="fu">flow_cfs_to_sed_cfd_calibrated</span><span class="op">(</span><span class="va">flow</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sediment_transport_f3_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sediment_transport_f3_day</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sediment_transport_f3_day</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">starting_volume</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">254690.3</span> <span class="op">*</span> <span class="fl">10.764</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">kwk_sed_transport_sim</span> <span class="op">&lt;-</span> <span class="va">calibrated_kwk_sed_transport</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2015-01-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2017-04-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sediment_transport_f3_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sediment_transport_f3_day</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sediment_transport_f3_day</span><span class="op">)</span>, </span>
<span>         sediment_transport_f3_day_accum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">sediment_transport_f3_day</span><span class="op">)</span>,</span>
<span>         start_vol <span class="op">=</span> <span class="va">starting_volume</span>,</span>
<span>         current_vol <span class="op">=</span> <span class="va">start_vol</span> <span class="op">-</span> <span class="va">sediment_transport_f3_day_accum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">kwk_sed_transport_sim</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="va">current_vol</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Spawning Habitat Vol. (cubic feet)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">kwk_usgs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="st">"2015-01-01"</span>, <span class="va">Date</span> <span class="op">&lt;=</span> <span class="st">"2017-04-01"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Flow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to confirm scaledown did the right thing</span></span>
<span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">p2</span>, <span class="va">p1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow-driven-spawning-decay_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="section level4">
<h4 id="second-update-to-the-transport-curves">Second update to the transport curves<a class="anchor" aria-label="anchor" href="#second-update-to-the-transport-curves"></a>
</h4>
<p>At this point, we can apply both scale-downs (gravel size and
observed) to update our current transport curves. To do this, we simply
apply both scale-downs in the function generation call to
<code>approxfun</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_sfd_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_min</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span> <span class="op">*</span> <span class="va">result</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">avg_sfd_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_avg</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span> <span class="op">*</span> <span class="va">result</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">max_sfd_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  y <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">sed_ft3_per_day_max</span> <span class="op">*</span> </span>
<span>    <span class="va">gravel_size_to_prop_of_movement</span><span class="op">$</span><span class="va">avg_fraction</span> <span class="op">*</span> <span class="va">result</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">min_sfd_with_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">min_sfd_gravel_obs</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"min"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">avg_sfd_with_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">avg_sfd_gravel_obs</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"mean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">max_sfd_with_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  flow_cfs <span class="op">=</span> <span class="va">srh2d_upper_sac_rating_curves</span><span class="op">$</span><span class="va">flow_cfs</span>, </span>
<span>  transport_cfd <span class="op">=</span> <span class="fu">max_sfd_gravel_obs</span><span class="op">(</span><span class="va">flow_cfs</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"max"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transport_scaled_by_gravel_obs</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="va">min_sfd_with_gravel_obs</span>, </span>
<span>  <span class="va">avg_sfd_with_gravel_obs</span>, </span>
<span>  <span class="va">max_sfd_with_gravel_obs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">transport_scaled_by_gravel_obs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">flow_cfs</span>, <span class="va">transport_cfd</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="flow-driven-spawning-decay_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emanuel Rodriguez, Erin Cain, Mark Tompkins, Sadie Gill.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
